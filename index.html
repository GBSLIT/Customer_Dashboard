<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Dashboard</title>

  <style>
  /* Base */
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: url('images/background.jpg') no-repeat center center fixed;
    background-size: cover;
  }
  .container {
    width: 100%;
    max-width: 1350px;
    margin: 0 auto;
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  }

  /* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  background-color: #fbfbfb;
  color: black;
  padding: 35px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

.header img {
  height: 50px;
  position: absolute;
  left: 35px; /* keeps logo left like before */
}

.header h1 {
  font-size: 24px;
  margin: 0;
  text-align: center;
  width: 100%; /* ensures proper centering */
}


  /* Stats grid */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    margin: 20px 0;
  }
  .stats div {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  .stats h3 { font-size: 18px; margin: 0 0 10px; }
  .stats p  { font-size: 16px; margin: 0; color: #333; }

  /* Cards */
  .order-details, .milestones, .tracking {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    overflow-x: auto; /* allow horizontal scroll for wide tables on phones */
  }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    min-width: 640px; /* prevents columns from crushing on phones */
  }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 10px; text-align: left; }
  th { background-color: #f4f4f4; }

  .po-number { cursor: pointer; color: blue; text-decoration: underline; }

  /* Milestones layout */
  .chart {
    display: flex;
    gap: 20px;
    justify-content: space-between;
    margin-top: 20px;
  }
  .chart > div { flex: 1; }
  #poChart { width: 100% !important; height: 320px !important; }

  /* Tracking rows */
  .tracking { display: none; } /* initially hidden */
  .tracking .tracking-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px 20px;
    margin-bottom: 10px;
  }
  .tracking .tracking-row > div {
    flex: 1 1 280px;
    min-width: 200px;
  }

  /* Timeline visualization */
  .visualization {
    display: flex;
    gap: 24px;
    justify-content: space-between;
    margin-top: 40px;
    overflow-x: auto;   /* scroll on mobile instead of breaking */
    padding-bottom: 8px;
  }
  .step { position: relative; text-align: center; flex: 0 0 220px; }
  .step .step-dot {
    width: 25px; height: 25px; border-radius: 50%; background-color: #ccc; margin: 0 auto; position: relative; z-index: 1;
  }
  .step .step-line {
    position: absolute; top: 12px; left: 0; right: 0; height: 2px; background-color: #ccc; z-index: 0;
  }

  /* Responsive tweaks */
  @media (max-width: 1024px) {
    .header h1 { font-size: 22px; }
    #poChart { height: 300px !important; }
  }
  @media (max-width: 768px) {
    .container { padding: 14px; }
    .header { padding: 16px; }
    .header img { height: 42px; }
    .header h1 { font-size: 20px; }
    .chart { flex-direction: column; }
    table { min-width: 560px; }
    #poChart { height: 280px !important; }
  }
  @media (max-width: 480px) {
    .header h1 { font-size: 18px; }
    .stats { grid-template-columns: 1fr 1fr; }
    .stats div { padding: 16px; }
    table { min-width: 520px; }
    #poChart { height: 240px !important; }
    .visualization { margin-top: 24px; }
  }
/* Mobile header fix: stack logo and title on small screens */
@media (max-width: 600px) {
  .header {
    padding: 16px;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* stack logo + title */
  }
  .header img {
    position: static;
    left: auto;
    margin: 0 auto 8px;
    height: 42px;
    display: block;
  }
  .header h1 {
    width: auto;
    text-align: center;
    font-size: 20px;
    margin: 0;
  }

  /* optional: for your stats cards two-column on mobile */
  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .stats div {
    margin: 0;
    padding: 14px;
  }
}  
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <img src="images/logo.png" alt="GBSL" />
      <h1>Customer Dashboard</h1>
    </div>

    <div class="stats">
      <div>
        <h3>Customer</h3>
        <p id="newOrders">0</p>
      </div>
      <div>
        <h3>Total Orders</h3>
        <p id="totalOrders">0</p>
      </div>
      <div>
        <h3>Shipped Orders</h3>
        <p id="shippedOrders">0</p>
      </div>
      <div>
        <h3>Pending to Ship</h3>
        <p id="pendingToShip">0</p>
      </div>
      <div>
        <h3>Upcoming Shipment</h3>
        <p id="upcomingShipment">0</p>
      </div>
    </div>

    <div class="order-details">
      <h3>Order Details</h3>
      <table id="orderTable">
        <tr>
          <th>Date</th>
          <th>PO Number</th>
          <th>Customer Name</th>
          <th>Port of Origin</th>
          <th>Port Of Destination</th>
          <th>ETD</th>
          <th>Country</th>
        </tr>
        <!-- Rows populated by JavaScript -->
      </table>
    </div>

    <div class="milestones">
      <h3>PO Current Status:</h3>
      <div class="chart">
        <div>
          <table id="milestonesTable">
            <tr>
              <th>Steps</th>
              <th>Number of PO's</th>
            </tr>
            <!-- Rows populated by JavaScript -->
          </table>
        </div>
        <div>
          <canvas id="poChart"></canvas>
        </div>
      </div>
    </div>

    <div class="tracking" id="trackingSection">
      <h3>Tracking</h3>
      <div class="tracking-row">
        <div><b>PO Number</b> – <span id="trackingPONumber"></span></div>
        <div><b>Customer Name</b> – <span id="trackingCustomerName"></span></div>
        <div><b>ETD</b> – <span id="trackingETD"></span></div>
      </div>
      <div class="tracking-row">
        <div><b>Port of Origin</b> – <span id="trackingPortOfOrigin"></span></div>
        <div><b>Port Of Destination</b> – <span id="trackingPortOfDestination"></span></div>
        <div><b>Current Stage</b> – <span id="trackingShippedDate"></span></div>
      </div>
      <table id="trackingTable">
        <tr>
          <th>Step</th>
          <th>Planned Date</th>
          <th>Actual Date</th>
          <th>Status</th>
          <th>Remark</th>
        </tr>
        <tr>
          <td>Pre-Production Meeting</td>
          <td id="ppPlannedDate"></td>
          <td id="ppActualDate"></td>
          <td id="ppStatus"></td>
          <td id="ppRemark"></td>
        </tr>
        <tr>
          <td>Label Artwork Approval</td>
          <td id="laPlannedDate"></td>
          <td id="laActualDate"></td>
          <td id="laStatus"></td>
          <td id="laRemark"></td>
        </tr>
        <tr>
          <td>Cargo Booking submission and SO Received</td>
          <td id="cbPlannedDate"></td>
          <td id="cbActualDate"></td>
          <td id="cbStatus"></td>
          <td id="cbRemark"></td>
        </tr>
        <tr>
          <td>Midline Inspection</td>
          <td id="miPlannedDate"></td>
          <td id="miActualDate"></td>
          <td id="miStatus"></td>
          <td id="miRemark"></td>
        </tr>
        <tr>
          <td>Final Inspection Report Submission and Approval</td>
          <td id="fiPlannedDate"></td>
          <td id="fiActualDate"></td>
          <td id="fiStatus"></td>
          <td id="fiRemark"></td>
        </tr>
        <tr>
          <td>BL Received</td>
          <td id="blPlannedDate"></td>
          <td id="blActualDate"></td>
          <td id="blStatus"></td>
          <td id="blRemark"></td>
        </tr>
        <tr>
          <td>Payment Realization and Confirmation</td>
          <td id="prPlannedDate"></td>
          <td id="prActualDate"></td>
          <td id="prStatus"></td>
          <td id="prRemark"></td>
        </tr>
      </table>
    </div>

    <div class="visualization" id="visualization">
      <!-- Steps populated by JavaScript -->
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const API_KEY = 'AIzaSyDIQwldr8SG1D71XI82vGycV0ueZ-cesV0';
    const SPREADSHEET_ID = '1NwNkVa2wg2hSFreDPX9CHM2m-9gk4wZz8gj4xFDnA3E';
    const ORDER_RANGE = 'Orders!A1:G';
    const MILESTONES_RANGE = 'Milestones!N1:O';
    const TRACKING_RANGE = 'Tracking!A1:AC';
    const GRAPH_RANGE = 'Graph!A1:H';
    const OTHER_DETAILS_RANGES = [
      { id: 'newOrders', range: 'Other Details!A1:A2' },
      { id: 'totalOrders', range: 'Other Details!B1:B2' },
      { id: 'shippedOrders', range: 'Other Details!C1:C2' },
      { id: 'pendingToShip', range: 'Other Details!D1:D2' },
      { id: 'upcomingShipment', range: 'Other Details!E1:E2' }
    ];

    async function fetchData(range) {
      const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`);
      const data = await response.json();
      if (data.error) {
        console.error('Error fetching data:', data.error);
        return [];
      }
      return data.values;
    }

    function populateOrderTable(orders) {
      const table = document.getElementById('orderTable');
      table.innerHTML = `
        <tr>
          <th>Date</th>
          <th>PO Number</th>
          <th>Customer Name</th>
          <th>Vendor Name</th>
          <th>Country</th>
          <th>ETD</th>
          <th>Stage</th>
        </tr>`;
      orders.slice(1).forEach(order => {
        const row = table.insertRow();
        order.forEach((cellData, index) => {
          const cell = row.insertCell();
          cell.textContent = cellData;
          if (index === 1) {
            cell.classList.add('po-number');
            cell.dataset.po = cellData;
            cell.addEventListener('click', () => openTrackingPage(cellData));
          }
        });
      });
    }

    function openTrackingPage(poNumber) {
      window.open(`tracking.html?po=${poNumber}`, '_blank');
    }

    function populateMilestonesTable(milestones) {
      const table = document.getElementById('milestonesTable');
      table.innerHTML = `
        <tr>
          <th>Steps</th>
          <th>Number of PO's</th>
        </tr>`;
      milestones.slice(1).forEach(milestone => {
        const row = table.insertRow();
        milestone.forEach(cellData => {
          const cell = row.insertCell();
          cell.textContent = cellData;
        });
      });
    }

    function updateChart(milestones) {
      const labels = milestones.slice(1).map(m => m[0]);
      const data = milestones.slice(1).map(m => parseInt(m[1], 10) || 0);

      const ctx = document.getElementById('poChart').getContext('2d');
      if (window.poChart && typeof window.poChart.destroy === 'function') {
        window.poChart.destroy();
      }
      window.poChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Number of PO\'s',
            data: data,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          maintainAspectRatio: false,
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function updateData() {
      fetchData(ORDER_RANGE).then(populateOrderTable).catch(err => console.error('Error fetching order data:', err));
      fetchData(MILESTONES_RANGE).then(milestones => {
        populateMilestonesTable(milestones);
        updateChart(milestones);
      }).catch(err => console.error('Error fetching milestones data:', err));

      OTHER_DETAILS_RANGES.forEach(detail => {
        fetchData(detail.range).then(data => {
          if (data.length > 1) {
            document.getElementById(detail.id).textContent = data[1][0];
          }
        }).catch(err => console.error(`Error fetching ${detail.id} data:`, err));
      });
    }

    updateData();
    setInterval(updateData, 60000);
  </script>
</body>
</html>

